<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Hello KYLE</title>
	<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">

	<!--标准mui.css-->
	<link rel="stylesheet" href="css/mui.min.css">
	<!--App自定义的css-->
	<link rel="stylesheet" href="css/app.css"/>
</head>
<body ng-app="ngApp" ng-controller="ngCtrl">
	<header class="mui-bar mui-bar-nav">
		<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
		<h1 class="mui-title">INDEX</h1>
	</header>
	<div class="mui-content">
		<div class="mui-content-padded" style="padding-bottom: 50px;">
			<p style="text-indent: 22px;">
				mui基于html5plus的<a href="http://www.dcloud.io/docs/api/zh_cn/xhr.shtml">XMLHttpRequest</a>，封装了常用的ajax函数，支持Get、Post请求方式， 支持返回json、xml、html、text、script数据类型；
			</p>
			<h4 class="mui-content-padded">发送请求：</h4>
			<h4 class="mui-content-padded"> {{firstName + " " + lastName}}</h4>
			<div class="mui-input-group">
				<div class="mui-input-row">
					<label>type:</label>
					<select id="method">
						<option value="get">GET</option>
						<option value="post">POST</option>
					</select>
				</div>
				<div class="mui-input-row">
					<label>dataType:</label>
					<select id="dataType">
						<option value="html">HTML</option>
						<option value="json">JSON</option>
						<option value="xml">XML</option>
					</select>
				</div>
				<div class="mui-button-row">
					<button type="button" id="confirm" class="mui-btn mui-btn-primary">发送请求</button>
				</div>
			</div>
			<h4 class="mui-content-padded">获得响应：</h4>
			<code id="response"></code>
		</div>
	</div>
	<script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script> 
	<script src="js/mui.min.js"></script>
	<script src="js/angular.min.js"></script>
	<script>
		angular.module('ngApp', []).controller('ngCtrl', function($scope) {
			$scope.firstName = "John";
			$scope.lastName = "Doe";
			$scope.ngData = {
				a:1,
				b:2
			};

			setTimeout(function(){
				mui.init({
						swipeBack:true //启用右滑关闭功能
					});
				console.log('run to here');
				/*这段代码是固定的，必须要放到js中*/
				function setupWebViewJavascriptBridge(callback) {
					if (window.WebViewJavascriptBridge) { return callback(WebViewJavascriptBridge); }
					if (window.WVJBCallbacks) { return window.WVJBCallbacks.push(callback); }
					window.WVJBCallbacks = [callback];
					var WVJBIframe = document.createElement('iframe');
					WVJBIframe.style.display = 'none';
					WVJBIframe.src = 'wvjbscheme://__BRIDGE_LOADED__';
					document.documentElement.appendChild(WVJBIframe);
					setTimeout(function() { document.documentElement.removeChild(WVJBIframe) }, 0)
				}
				
				setupWebViewJavascriptBridge(function(bridge) {
					//Register a JS handler
					bridge.registerHandler('showMyName', function(data, responseCallback) {
                        alert("my name is " + data.name);
                        if(responseCallback != null){
                            responseCallback({'retCode': '0', 'retMess': 'YOUR NAME SHOWED'});
                        }
					});
                    //Register a JS handler without Data and Response Callback
                    bridge.registerHandler('showMyName', function() {
                        alert('435345');
                    });
					
					// Call an OC handler with Data and Response Callback
					bridge.callHandler('getUserId', {'key':'value'} ,function(responseData) {
						alert("responseData" + responseData.userId)
					});
					
					// Call an OC handler without Data and Response Callback
					bridge.callHandler('getUserId');
					
				})
			}); 
		});
	</script>
</body>

</html>
